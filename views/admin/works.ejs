<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Yuxuan Lin | Dashboard | Works</title>
		<%- include('../partials/head') %>
	</head>

	<body class="dashboard">
		<%- include('../partials/aside') %>
		<script>
			document.querySelector( 'aside .middle ul li:nth-child(2) a' )
				.classList.add( 'active' );
		</script>
		<main id="works" data-dashboard class="db-table">
			<div class="heading">
				<h1 class="secondary-header">Works</h1>
				<a class="btn-primary" href="/dashboard/works/new">Add New</a>
			</div>
			<table class="primary-table">
				<colgroup>
					<col />
					<col />
					<col class="icon" />
					<col class="icon" />
				</colgroup>
				<tr>
					<th>Title</th>
					<th>Date</th>
					<th>Edit</th>
					<th>Delete</th>
				</tr>

				<% for( let i = 0; i < works.length; i++ ) { %>

				<% 
						const id = works[i]._id;
						const body = JSON.parse(works[i].body);
						const title = body.title;
						const slug = body.slug;
						const date = works[i].date.toDateString();
						
						%>

				<tr data-work-id="<%= id %>">
					<td>
						<a href="/work/<%= slug %>" target="_blank" class="table-link"><%= title %></a>
					</td>
					<td><%= date %></td>
					<td>
						<a href="/dashboard/works/<%= id %>/edit" class="icon">
							<i class="fa-solid fa-pen-to-square"></i>
						</a>
					</td>
					<td>
						<form data-method="delete" action="/dashboard/works/<%= id %>/delete" class="handle-form-submission" name="work">
							<button type="submit" class="icon">
								<i class="fa-solid fa-trash"></i>
							</button>
						</form>
					</td>
				</tr>
				<% } %>
			</table>
		</main>
	</body>

</html>