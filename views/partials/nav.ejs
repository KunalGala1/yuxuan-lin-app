<%
const nav = {
  menu: 'nav-menu', link_classes: 'nav-link', map: [
    {name: 'home', text: lang === 'zh' ? '首页' : 'home'},
    {name: 'bio', text: lang === 'zh' ? '个人简介' : 'bio'},
    {name: 'events', text: lang === 'zh' ? '事件' : 'events'},
    
    {name: 'works', text: lang === 'zh' ? '作品' : 'works'},
    {name: 'media', text: lang === 'zh' ? '媒体' : 'media'},
    {name: 'arranger', text: lang === 'zh' ? '编曲' : 'arranger'},
    {name: 'contact', text: lang === 'zh' ? '联系' : 'contact', liClass: 'last-child'},
  ]
}

const generateMenu = data => {
  let html = `<ul class="${data.menu}">`;
  data.map.forEach(item => {
    const name = item.name;
    const text = item.text || item.name;
    const liClass = item.liClass || '';
    let href = (item.name === 'home' || name === '首页') ? '/' : (item.href || `/${name}`);
    href += '?lang=' + lang;
    console.log(name, href);
    if (!item.menu) html += `<li class="${liClass}"><a href='${href}' class="${data.link_classes}">${text}</a></li>`;
    else { html += `<li class="${item.menu + '--parent'}"><span>${text}</span>${generateMenu(item)}</li>`}
  })
  html +=
  `
  <div id="gradient"></div>
  <script src="/js/gradient-no-scroll.js" defer></script>
  </ul>
  `
  return html;
}
%>

<nav>

  <%- generateMenu(nav) %>

  <div id="burger">
    <div></div>
    <div></div>
    <div></div>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Getting the current path and removing query parameters
    let path = window.location.pathname;
    let links = document.getElementsByClassName('nav-link');

    for (let i = 0; i < links.length; i++) {
      let href = links[i].getAttribute('href');
      // Splitting href on '?' to remove any query parameters
      href = href.split('?')[0];
      // Check if the href attribute of the link matches the current path
      if (href === path) {
        // Add 'active' class to the matching link
        links[i].classList.add('active');
        break;
      }
    }
  });
</script>